---
import Layout from '../layouts/Layout.astro';
import { createUrl } from '../utils/url';

// Wszystkie dostƒôpne pytania (20)
const allQuestions = [
  {
    "id": 1,
    "question": "Czym jest sztuczna inteligencja (AI)?",
    "options": [
      "Tylko programy komputerowe do gier",
      "Technologia pozwalajƒÖca maszynom wykonywaƒá zadania wymagajƒÖce inteligencji podobnej do ludzkiej",
      "Wy≈ÇƒÖcznie roboty humanoidalne",
      "System do przechowywania danych"
    ],
    "correct": 1
  },
  {
    "id": 2,
    "question": "W kt√≥rym roku po raz pierwszy u≈ºyto terminu 'artificial intelligence'?",
    "options": ["1950", "1956", "1960", "1943"],
    "correct": 1
  },
  {
    "id": 3,
    "question": "Kt√≥ry z poni≈ºszych NIE jest przyk≈Çadem AI w codziennym ≈ºyciu?",
    "options": [
      "Asystenci g≈Çosowi (Siri, Alexa)",
      "Systemy rekomendacji Netflix",
      "Nawigacja GPS",
      "Zwyk≈Çy kalkulator"
    ],
    "correct": 3
  },
  {
    "id": 4,
    "question": "Co to jest Test Turinga?",
    "options": [
      "Test szybko≈õci komputera",
      "Test sprawdzajƒÖcy, czy maszyna mo≈ºe 'my≈õleƒá' jak cz≈Çowiek",
      "Test bezpiecze≈Ñstwa system√≥w",
      "Test wydajno≈õci algorytm√≥w"
    ],
    "correct": 1
  },
  {
    "id": 5,
    "question": "Co spowodowa≈Ço 'zimy AI' w historii sztucznej inteligencji?",
    "options": [
      "Tylko wysokie koszty bada≈Ñ",
      "Brak zainteresowania naukowc√≥w",
      "Przeszacowane oczekiwania, ograniczona moc obliczeniowa i wysokie koszty",
      "Problemy z internetem"
    ],
    "correct": 2
  },
  {
    "id": 6,
    "question": "Kt√≥ry system AI pokona≈Ç mistrza ≈õwiata w szachach w 1997 roku?",
    "options": ["AlphaGo", "Deep Blue", "Watson", "GPT-1"],
    "correct": 1
  },
  {
    "id": 7,
    "question": "Co zmieni≈Ço siƒô miƒôdzy latami 70. a wsp√≥≈Çczesno≈õciƒÖ, umo≈ºliwiajƒÖc rozw√≥j AI?",
    "options": [
      "Tylko lepsze komputery",
      "Eksplozja danych, wiƒôksza moc obliczeniowa i nowe algorytmy",
      "Tylko wiƒôcej pieniƒôdzy na badania",
      "Tylko internet"
    ],
    "correct": 1
  },
  {
    "id": 8,
    "question": "Kt√≥ry prze≈Çom w 2012 roku rozpoczƒÖ≈Ç erƒô g≈Çƒôbokiego uczenia?",
    "options": ["GPT-1", "AlexNet", "ELIZA", "Perceptron"],
    "correct": 1
  },
  {
    "id": 9,
    "question": "Co charakteryzuje wsp√≥≈ÇczesnƒÖ rewolucjƒô AI (od 2010 roku)?",
    "options": [
      "Tylko szybsze komputery",
      "Deep learning, transformery i modele jƒôzykowe",
      "Tylko wiƒôcej danych",
      "Tylko lepsze algorytmy z lat 80."
    ],
    "correct": 1
  },
  {
    "id": 10,
    "question": "Kt√≥ra z poni≈ºszych lekcji p≈Çynie z historii AI?",
    "options": [
      "Postƒôp jest zawsze liniowy i przewidywalny",
      "AI nie potrzebuje wsp√≥≈Çpracy naukowc√≥w",
      "Postƒôp nie jest liniowy i prze≈Çomy sƒÖ czƒôsto nieprzewidywalne",
      "Historia AI nie ma znaczenia dla przysz≈Ço≈õci"
    ],
    "correct": 2
  },
  {
    "id": 11,
    "question": "Co to jest uczenie maszynowe (Machine Learning)?",
    "options": [
      "Programowanie tradycyjnych algorytm√≥w",
      "Dziedzina AI, kt√≥ra pozwala komputerom uczyƒá siƒô bez bezpo≈õredniego programowania",
      "Tylko analiza danych statistycznych",
      "System zarzƒÖdzania bazami danych"
    ],
    "correct": 1
  },
  {
    "id": 12,
    "question": "Kt√≥re z poni≈ºszych to rodzaje uczenia maszynowego?",
    "options": [
      "Tylko uczenie nadzorowane",
      "Uczenie nadzorowane, nienadzorowane i ze wzmocnieniem",
      "Tylko uczenie g≈Çƒôbokie",
      "Tylko sieci neuronowe"
    ],
    "correct": 1
  },
  {
    "id": 13,
    "question": "Co to jest sieƒá neuronowa?",
    "options": [
      "System do ≈ÇƒÖczenia komputer√≥w",
      "Model matematyczny inspirowany dzia≈Çaniem m√≥zgu",
      "Typ bazy danych",
      "Protok√≥≈Ç internetowy"
    ],
    "correct": 1
  },
  {
    "id": 14,
    "question": "Czym r√≥≈ºni siƒô AI wƒÖska (Narrow AI) od AI og√≥lnej (AGI)?",
    "options": [
      "Nie ma r√≥≈ºnicy",
      "AI wƒÖska wykonuje konkretne zadania, AGI mog≈Çaby wykonywaƒá dowolne zadania intelektualne",
      "AI wƒÖska jest szybsza",
      "AGI jest ta≈Ñsza w produkcji"
    ],
    "correct": 1
  },
  {
    "id": 15,
    "question": "Co to sƒÖ du≈ºe modele jƒôzykowe (LLM)?",
    "options": [
      "Systemy do t≈Çumaczenia jƒôzyk√≥w",
      "Modele AI trenowane na ogromnych ilo≈õciach tekstu do rozumienia i generowania jƒôzyka",
      "S≈Çowniki cyfrowe",
      "Programy do korekty pisowni"
    ],
    "correct": 1
  },
  {
    "id": 16,
    "question": "Kt√≥re z poni≈ºszych to przyk≈Çady zastosowa≈Ñ AI w medycynie?",
    "options": [
      "Tylko diagnoza obrazowa",
      "Diagnoza, odkrywanie lek√≥w, chirurgia robotyczna i analiza genetyczna",
      "Tylko prowadzenie dokumentacji",
      "Tylko kalkulatory medyczne"
    ],
    "correct": 1
  },
  {
    "id": 17,
    "question": "Co to jest 'hallucination' w kontek≈õcie AI?",
    "options": [
      "Problem z wy≈õwietlaczem",
      "Gdy AI generuje nieprawdziwe lub wymy≈õlone informacje",
      "B≈ÇƒÖd w kodzie programu",
      "Problem z internetem"
    ],
    "correct": 1
  },
  {
    "id": 18,
    "question": "Jakie sƒÖ g≈Ç√≥wne wyzwania etyczne zwiƒÖzane z AI?",
    "options": [
      "Tylko wysokie koszty",
      "Bias, prywatno≈õƒá, przejrzysto≈õƒá, wp≈Çyw na zatrudnienie i bezpiecze≈Ñstwo",
      "Tylko szybko≈õƒá dzia≈Çania",
      "Tylko kompatybilno≈õƒá z systemami"
    ],
    "correct": 1
  },
  {
    "id": 19,
    "question": "Co to jest 'prompt engineering'?",
    "options": [
      "Budowanie komputer√≥w",
      "Sztuka tworzenia skutecznych instrukcji dla modeli AI",
      "Projektowanie stron internetowych",
      "Programowanie aplikacji mobilnych"
    ],
    "correct": 1
  },
  {
    "id": 20,
    "question": "Kt√≥rƒÖ z poni≈ºszych technologii mo≈ºna wykorzystaƒá do zr√≥wnowa≈ºonego rozwoju?",
    "options": [
      "Tylko panele s≈Çoneczne",
      "AI do optymalizacji energii, przewidywania pogody, zarzƒÖdzania zasobami i monitorowania ≈õrodowiska",
      "Tylko recykling",
      "Tylko transport publiczny"
    ],
    "correct": 1
  }
];

// Przeka≈º pytania do frontendu
const questionsJson = JSON.stringify(allQuestions);
---

<Layout title="Test ko≈Ñcowy - AI dla Zielonych" description="Sprawd≈∫ swojƒÖ wiedzƒô o sztucznej inteligencji i otrzymaj certyfikat uko≈Ñczenia kursu.">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        üìù Test ko≈Ñcowy
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        Sprawd≈∫ swojƒÖ wiedzƒô z kursu "AI dla Zielonych". Aby otrzymaƒá certyfikat, musisz uzyskaƒá 100% poprawnych odpowiedzi.
      </p>
    </div>

    <!-- Test locked notification -->
    <div class="bg-amber-50 border border-amber-200 rounded-lg p-6 mb-8">
      <div class="flex items-start space-x-3">
        <span class="text-2xl">üîí</span>
        <div>
          <h2 class="font-semibold text-amber-800 mb-2">Test tymczasowo niedostƒôpny</h2>
          <p class="text-amber-700 mb-4">
            Test ko≈Ñcowy zostanie odblokowany po pe≈Çnej publikacji wszystkich lekcji kursu. 
            Obecnie pracujemy nad finalizacjƒÖ materia≈Ç√≥w edukacyjnych.
          </p>
          <div class="text-amber-600 text-sm">
            <p class="font-medium mb-1">Co mo≈ºesz robiƒá w miƒôdzyczasie:</p>
            <ul class="space-y-1">
              <li>‚Ä¢ Przejrzyj ju≈º dostƒôpne lekcje</li>
              <li>‚Ä¢ Powt√≥rz materia≈Ç, kt√≥ry wydaje Ci siƒô trudny</li>
              <li>‚Ä¢ ≈öled≈∫ nasze aktualizacje</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Info panel (hidden until test is unlocked) -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8 opacity-50">
      <div class="flex items-start space-x-3">
        <span class="text-2xl">‚ÑπÔ∏è</span>
        <div>
          <h2 class="font-semibold text-blue-800 mb-2">Informacje o te≈õcie (wkr√≥tce dostƒôpne)</h2>
          <ul class="text-blue-700 text-sm space-y-1">
            <li>‚Ä¢ Test sk≈Çada siƒô z 10 pyta≈Ñ jednokrotnego wyboru</li>
            <li>‚Ä¢ Do zaliczenia wymagane jest 100% poprawnych odpowiedzi</li>
            <li>‚Ä¢ Mo≈ºesz podej≈õƒá do testu wielokrotnie</li>
            <li>‚Ä¢ Wynik zostanie pokazany natychmiast po zako≈Ñczeniu</li>
            <li>‚Ä¢ Po zaliczeniu bƒôdziesz m√≥g≈Ç pobraƒá certyfikat PDF</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Test container (disabled) -->
    <div id="test-container" class="bg-white rounded-lg shadow-lg border border-gray-200 p-8">
      <div class="text-center py-12">
        <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
          <span class="text-4xl text-gray-400">üîí</span>
        </div>
        <h2 class="text-2xl font-bold text-gray-500 mb-4">Test zostanie wkr√≥tce odblokowany</h2>
        <p class="text-gray-600 mb-8 max-w-md mx-auto">
          Pracujemy nad finalizacjƒÖ wszystkich lekcji kursu. Test ko≈Ñcowy bƒôdzie dostƒôpny po publikacji kompletnego materia≈Çu.
        </p>
        <a 
          href={createUrl("/lekcje")}
          class="inline-block bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:from-emerald-700 hover:to-teal-700 transform hover:scale-105 transition-all duration-200 shadow-lg"
        >
          Przejd≈∫ do lekcji
        </a>
      </div>
    </div>
  </div>

  <script define:vars={{ questionsJson }}>
    // Test jest tymczasowo zablokowany
    console.log('Test ko≈Ñcowy zostanie odblokowany po pe≈Çnej publikacji kursu.');
    
    // Wy≈ÇƒÖczenie funkcjonalno≈õci testu
    document.addEventListener('DOMContentLoaded', () => {
      // Ukryj wszystkie interaktywne elementy testu
      const testContainer = document.getElementById('test-container');
      if (testContainer) {
        // Usu≈Ñ wszystkie event listenery i funkcjonalno≈õƒá
        const buttons = testContainer.querySelectorAll('button');
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.style.pointerEvents = 'none';
        });
        
        const inputs = testContainer.querySelectorAll('input');
        inputs.forEach(input => {
          input.disabled = true;
          input.style.pointerEvents = 'none';
        });
      }
    });
    
    // Oryginalny kod testu (wy≈ÇƒÖczony)
    /*
    // Pytania przekazane z serwera
    const allQuestions = JSON.parse(questionsJson);
    
    // Funkcja do tasowania tablicy (Fisher-Yates shuffle)
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    // Funkcja do losowania 10 pyta≈Ñ z 20 dostƒôpnych
    function selectRandomQuestions() {
      const shuffledQuestions = shuffleArray(allQuestions);
      return shuffledQuestions.slice(0, 10);
    }
    
    let currentQuestions = [];
    let currentAnswers = {};
    
    function initializeTest() {
      const container = document.getElementById('questions-container');
      const submitBtn = document.getElementById('submit-test');
      
      if (!container || !submitBtn) return;
      
      // Wybierz losowe 10 pyta≈Ñ z dostƒôpnych
      currentQuestions = selectRandomQuestions();
      renderQuestions();
    }
    
    function renderQuestions() {
      const container = document.getElementById('questions-container');
      const submitBtn = document.getElementById('submit-test');
      
      if (!container || !submitBtn) return;
      
      container.innerHTML = '';
      currentAnswers = {};
      
      currentQuestions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'mb-8 p-6 border border-gray-200 rounded-lg';
        
        questionDiv.innerHTML = `
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            ${index + 1}. ${q.question}
          </h3>
          <div class="space-y-3">
            ${q.options.map((option, optIndex) => `
              <label class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                <input 
                  type="radio" 
                  name="question-${index}" 
                  value="${optIndex}"
                  class="w-4 h-4 text-emerald-600 focus:ring-emerald-500 border-gray-300"
                >
                <span class="text-gray-700">${option}</span>
              </label>
            `).join('')}
          </div>
        `;
        
        container.appendChild(questionDiv);
      });
      
      // Nas≈Çuchuj zmian w odpowiedziach
      container.addEventListener('change', (e) => {
        const target = e.target;
        if (target && target.type === 'radio') {
          const questionIndex = parseInt(target.name.split('-')[1]);
          currentAnswers[questionIndex] = parseInt(target.value);
          
          // Sprawd≈∫ czy wszystkie pytania zosta≈Çy odpowiedziane
          if (Object.keys(currentAnswers).length === currentQuestions.length) {
            submitBtn.disabled = false;
          }
        }
      });
      
      submitBtn.disabled = true;
    }
    
    function showResults() {
      let correctCount = 0;
      
      currentQuestions.forEach((q, index) => {
        if (currentAnswers[index] === q.correct) {
          correctCount++;
        }
      });
      
      const percentage = Math.round((correctCount / currentQuestions.length) * 100);
      
      const testForm = document.getElementById('test-form');
      const testResults = document.getElementById('test-results');
      
      if (!testForm || !testResults) return;
      
      testForm.classList.add('hidden');
      testResults.classList.remove('hidden');
      
      const successResult = document.getElementById('success-result');
      const failResult = document.getElementById('fail-result');
      
      if (!successResult || !failResult) return;
      
      if (percentage === 100) {
        successResult.classList.remove('hidden');
        failResult.classList.add('hidden');
      } else {
        successResult.classList.add('hidden');
        failResult.classList.remove('hidden');
        const scoreElement = document.getElementById('score-percentage');
        if (scoreElement) {
          scoreElement.textContent = `${percentage}%`;
        }
      }
    }
    
    function resetTest() {
      const testForm = document.getElementById('test-form');
      const testResults = document.getElementById('test-results');
      const certificateName = document.getElementById('certificate-name');
      
      if (!testForm || !testResults) return;
      
      testForm.classList.remove('hidden');
      testResults.classList.add('hidden');
      
      if (certificateName) {
        certificateName.value = '';
      }
      
      initializeTest();
    }
    
    function generateCertificate() {
      const nameInput = document.getElementById('certificate-name');
      
      if (!nameInput) return;
      
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('Proszƒô wprowadziƒá imiƒô i nazwisko');
        return;
      }
      
      // Generowanie certyfikatu jako obraz Canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      if (!ctx) return;
      
      canvas.width = 1200;
      canvas.height = 800;
      
      // Gradient t≈Ço
      const gradient = ctx.createLinearGradient(0, 0, 1200, 800);
      gradient.addColorStop(0, '#f0fdf4');
      gradient.addColorStop(1, '#ecfdf5');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 1200, 800);
      
      // Ramka
      ctx.strokeStyle = '#059669';
      ctx.lineWidth = 8;
      ctx.strokeRect(40, 40, 1120, 720);
      
      // Wewnƒôtrzna ramka
      ctx.strokeStyle = '#34d399';
      ctx.lineWidth = 2;
      ctx.strokeRect(60, 60, 1080, 680);
      
      // Nag≈Ç√≥wek
      ctx.fillStyle = '#065f46';
      ctx.font = 'bold 48px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('üèÜ CERTYFIKAT UKO≈ÉCZENIA', 600, 150);
      
      // Nazwa kursu
      ctx.fillStyle = '#059669';
      ctx.font = 'bold 36px Arial';
      ctx.fillText('AI DLA ZIELONYCH', 600, 220);
      
      // Potwierdzenie
      ctx.fillStyle = '#374151';
      ctx.font = '24px Arial';
      ctx.fillText('Niniejszym po≈õwiadcza siƒô, ≈ºe', 600, 300);
      
      // Imiƒô i nazwisko
      ctx.fillStyle = '#059669';
      ctx.font = 'bold 42px Arial';
      ctx.fillText(name.toUpperCase(), 600, 380);
      
      // Opis
      ctx.fillStyle = '#374151';
      ctx.font = '20px Arial';
      ctx.fillText('pomy≈õlnie uko≈Ñczy≈Ç/uko≈Ñczy≈Ça kurs podstaw sztucznej inteligencji', 600, 450);
      ctx.fillText('uzyskujƒÖc 100% poprawnych odpowiedzi w te≈õcie ko≈Ñcowym', 600, 480);
      
      // Data
      const currentDate = new Date().toLocaleDateString('pl-PL', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      ctx.fillStyle = '#6b7280';
      ctx.font = '18px Arial';
      ctx.fillText(`${currentDate}`, 600, 580);
      
      // Podpis
      ctx.fillStyle = '#059669';
      ctx.font = 'italic 16px Arial';
      ctx.fillText('AI dla Zielonych - Kurs podstaw sztucznej inteligencji', 600, 650);
      
      // Unikalne ID certyfikatu
      const certificateId = 'AZ-' + Date.now().toString(36).toUpperCase();
      ctx.fillStyle = '#9ca3af';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      ctx.fillText(`ID certyfikatu: ${certificateId}`, 1140, 740);
      
      // Pobieranie certyfikatu
      const link = document.createElement('a');
      link.download = `certyfikat-ai-dla-zielonych-${name.replace(/\s+/g, '-').toLowerCase()}.png`;
      link.href = canvas.toDataURL('image/png', 1.0);
      
      // Dodaj feedback dla u≈ºytkownika
      const generateBtn = document.getElementById('generate-certificate');
      if (generateBtn) {
        generateBtn.textContent = '‚è≥ Generowanie...';
        generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
      
      // Symulacja kr√≥tkiego op√≥≈∫nienia dla lepszego UX
      setTimeout(() => {
        link.click();
        
        if (generateBtn) {
          generateBtn.textContent = '‚úÖ Certyfikat pobrany!';
          setTimeout(() => {
            generateBtn.textContent = 'üèÜ Wygeneruj certyfikat PDF';
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          }, 2000);
        }
      }, 500);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      initializeTest();
      
      const submitBtn = document.getElementById('submit-test');
      const retakeBtn = document.getElementById('retake-test');
      const retakeFailBtn = document.getElementById('retake-test-fail');
      const generateBtn = document.getElementById('generate-certificate');
      
      if (submitBtn) {
        submitBtn.addEventListener('click', showResults);
      }
      if (retakeBtn) {
        retakeBtn.addEventListener('click', resetTest);
      }
      if (retakeFailBtn) {
        retakeFailBtn.addEventListener('click', resetTest);
      }
      if (generateBtn) {
        generateBtn.addEventListener('click', generateCertificate);
      }
    });
    */
  </script>
</Layout>

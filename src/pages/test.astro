---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Test koÅ„cowy - AI dla Zielonych" description="SprawdÅº swojÄ… wiedzÄ™ o sztucznej inteligencji i otrzymaj certyfikat ukoÅ„czenia kursu.">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        ğŸ“ Test koÅ„cowy
      </h1>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">
        SprawdÅº swojÄ… wiedzÄ™ z kursu "AI dla Zielonych". Aby otrzymaÄ‡ certyfikat, musisz uzyskaÄ‡ 100% poprawnych odpowiedzi.
      </p>
    </div>

    <!-- Info panel -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
      <div class="flex items-start space-x-3">
        <span class="text-2xl">â„¹ï¸</span>
        <div>
          <h2 class="font-semibold text-blue-800 mb-2">Informacje o teÅ›cie</h2>
          <ul class="text-blue-700 text-sm space-y-1">
            <li>â€¢ Test skÅ‚ada siÄ™ z 10 pytaÅ„ jednokrotnego wyboru</li>
            <li>â€¢ Do zaliczenia wymagane jest 100% poprawnych odpowiedzi</li>
            <li>â€¢ MoÅ¼esz podejÅ›Ä‡ do testu wielokrotnie</li>
            <li>â€¢ Wynik zostanie pokazany natychmiast po zakoÅ„czeniu</li>
            <li>â€¢ Po zaliczeniu bÄ™dziesz mÃ³gÅ‚ pobraÄ‡ certyfikat PDF</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Test container -->
    <div id="test-container" class="bg-white rounded-lg shadow-lg border border-gray-200 p-8">
      <div id="test-form">
        <div id="questions-container">
          <!-- Pytania bÄ™dÄ… wygenerowane przez JavaScript -->
        </div>
        
        <div class="mt-8 text-center">
          <button 
            id="submit-test" 
            class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:from-emerald-700 hover:to-teal-700 transform hover:scale-105 transition-all duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
            disabled
          >
            ZakoÅ„cz test
          </button>
        </div>
      </div>

      <!-- Results -->
      <div id="test-results" class="hidden">
        <div id="success-result" class="text-center hidden">
          <div class="mb-6">
            <div class="w-24 h-24 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center">
              <span class="text-4xl">ğŸ‰</span>
            </div>
            <h2 class="text-3xl font-bold text-green-600 mb-2">Gratulacje!</h2>
            <p class="text-xl text-gray-700 mb-6">
              UzyskaÅ‚eÅ› <span class="font-bold text-green-600">100%</span> poprawnych odpowiedzi!
            </p>
          </div>
          
          <!-- Certificate form -->
          <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold text-green-800 mb-4">Pobierz swÃ³j certyfikat</h3>
            <div class="max-w-md mx-auto">
              <input 
                type="text" 
                id="certificate-name" 
                placeholder="WprowadÅº swoje imiÄ™ i nazwisko"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 mb-4"
                required
              >
              <button 
                id="generate-certificate"
                class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-200"
              >
                ğŸ† Wygeneruj certyfikat PDF
              </button>
            </div>
          </div>
          
          <button 
            id="retake-test" 
            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors duration-200"
          >
            PowtÃ³rz test
          </button>
        </div>

        <div id="fail-result" class="text-center hidden">
          <div class="mb-6">
            <div class="w-24 h-24 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center">
              <span class="text-4xl">ğŸ˜”</span>
            </div>
            <h2 class="text-3xl font-bold text-red-600 mb-2">Nie udaÅ‚o siÄ™ tym razem</h2>
            <p class="text-xl text-gray-700 mb-2">
              UzyskaÅ‚eÅ› <span id="score-percentage" class="font-bold text-red-600"></span> poprawnych odpowiedzi.
            </p>
            <p class="text-gray-600 mb-6">
              Do otrzymania certyfikatu potrzebujesz 100% poprawnych odpowiedzi.
            </p>
          </div>
          
          <div class="space-y-4">
            <button 
              id="retake-test-fail" 
              class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:from-emerald-700 hover:to-teal-700 transform hover:scale-105 transition-all duration-200 shadow-lg"
            >
              ğŸ”„ SprÃ³buj ponownie
            </button>
            <br>
            <a 
              href="/lekcje" 
              class="inline-block bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors duration-200"
            >
              ğŸ“š WrÃ³Ä‡ do lekcji
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Pytania testowe
    const questions = [
      {
        question: "Czym jest sztuczna inteligencja (AI)?",
        options: [
          "Tylko programy komputerowe do gier",
          "Technologia pozwalajÄ…ca maszynom wykonywaÄ‡ zadania wymagajÄ…ce inteligencji podobnej do ludzkiej",
          "WyÅ‚Ä…cznie roboty humanoidalne",
          "System do przechowywania danych"
        ],
        correct: 1
      },
      {
        question: "W ktÃ³rym roku po raz pierwszy uÅ¼yto terminu 'artificial intelligence'?",
        options: ["1950", "1956", "1960", "1943"],
        correct: 1
      },
      {
        question: "KtÃ³ry z poniÅ¼szych NIE jest przykÅ‚adem AI w codziennym Å¼yciu?",
        options: [
          "Asystenci gÅ‚osowi (Siri, Alexa)",
          "Systemy rekomendacji Netflix",
          "Nawigacja GPS",
          "ZwykÅ‚y kalkulator"
        ],
        correct: 3
      },
      {
        question: "Co to jest Test Turinga?",
        options: [
          "Test szybkoÅ›ci komputera",
          "Test sprawdzajÄ…cy, czy maszyna moÅ¼e 'myÅ›leÄ‡' jak czÅ‚owiek",
          "Test bezpieczeÅ„stwa systemÃ³w",
          "Test wydajnoÅ›ci algorytmÃ³w"
        ],
        correct: 1
      },
      {
        question: "Co spowodowaÅ‚o 'zimy AI' w historii sztucznej inteligencji?",
        options: [
          "Tylko wysokie koszty badaÅ„",
          "Brak zainteresowania naukowcÃ³w",
          "Przeszacowane oczekiwania, ograniczona moc obliczeniowa i wysokie koszty",
          "Problemy z internetem"
        ],
        correct: 2
      },
      {
        question: "KtÃ³ry system AI pokonaÅ‚ mistrza Å›wiata w szachach w 1997 roku?",
        options: ["AlphaGo", "Deep Blue", "Watson", "GPT-1"],
        correct: 1
      },
      {
        question: "Co zmieniÅ‚o siÄ™ miÄ™dzy latami 70. a wspÃ³Å‚czesnoÅ›ciÄ…, umoÅ¼liwiajÄ…c rozwÃ³j AI?",
        options: [
          "Tylko lepsze komputery",
          "Eksplozja danych, wiÄ™ksza moc obliczeniowa i nowe algorytmy",
          "Tylko wiÄ™cej pieniÄ™dzy na badania",
          "Tylko internet"
        ],
        correct: 1
      },
      {
        question: "KtÃ³ry przeÅ‚om w 2012 roku rozpoczÄ…Å‚ erÄ™ gÅ‚Ä™bokiego uczenia?",
        options: ["GPT-1", "AlexNet", "ELIZA", "Perceptron"],
        correct: 1
      },
      {
        question: "Co charakteryzuje wspÃ³Å‚czesnÄ… rewolucjÄ™ AI (od 2010 roku)?",
        options: [
          "Tylko szybsze komputery",
          "Deep learning, transformery i modele jÄ™zykowe",
          "Tylko wiÄ™cej danych",
          "Tylko lepsze algorytmy z lat 80."
        ],
        correct: 1
      },
      {
        question: "KtÃ³ra z poniÅ¼szych lekcji pÅ‚ynie z historii AI?",
        options: [
          "PostÄ™p jest zawsze liniowy i przewidywalny",
          "AI nie potrzebuje wspÃ³Å‚pracy naukowcÃ³w",
          "PostÄ™p nie jest liniowy i przeÅ‚omy sÄ… czÄ™sto nieprzewidywalne",
          "Historia AI nie ma znaczenia dla przyszÅ‚oÅ›ci"
        ],
        correct: 2
      }
    ];

    let currentAnswers: { [key: number]: number } = {};
    
    function initializeTest() {
      const container = document.getElementById('questions-container');
      const submitBtn = document.getElementById('submit-test') as HTMLButtonElement;
      
      if (!container || !submitBtn) return;
      
      container.innerHTML = '';
      currentAnswers = {};
      
      questions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'mb-8 p-6 border border-gray-200 rounded-lg';
        
        questionDiv.innerHTML = `
          <h3 class="text-lg font-semibold text-gray-900 mb-4">
            ${index + 1}. ${q.question}
          </h3>
          <div class="space-y-3">
            ${q.options.map((option, optIndex) => `
              <label class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                <input 
                  type="radio" 
                  name="question-${index}" 
                  value="${optIndex}"
                  class="w-4 h-4 text-emerald-600 focus:ring-emerald-500 border-gray-300"
                >
                <span class="text-gray-700">${option}</span>
              </label>
            `).join('')}
          </div>
        `;
        
        container.appendChild(questionDiv);
      });
      
      // NasÅ‚uchuj zmian w odpowiedziach
      container.addEventListener('change', (e) => {
        const target = e.target as HTMLInputElement;
        if (target && target.type === 'radio') {
          const questionIndex = parseInt(target.name.split('-')[1]);
          currentAnswers[questionIndex] = parseInt(target.value);
          
          // SprawdÅº czy wszystkie pytania zostaÅ‚y odpowiedziane
          if (Object.keys(currentAnswers).length === questions.length) {
            submitBtn.disabled = false;
          }
        }
      });
      
      submitBtn.disabled = true;
    }
    
    function showResults() {
      let correctCount = 0;
      
      questions.forEach((q, index) => {
        if (currentAnswers[index] === q.correct) {
          correctCount++;
        }
      });
      
      const percentage = Math.round((correctCount / questions.length) * 100);
      
      const testForm = document.getElementById('test-form');
      const testResults = document.getElementById('test-results');
      
      if (!testForm || !testResults) return;
      
      testForm.classList.add('hidden');
      testResults.classList.remove('hidden');
      
      const successResult = document.getElementById('success-result');
      const failResult = document.getElementById('fail-result');
      
      if (!successResult || !failResult) return;
      
      if (percentage === 100) {
        successResult.classList.remove('hidden');
        failResult.classList.add('hidden');
      } else {
        successResult.classList.add('hidden');
        failResult.classList.remove('hidden');
        const scoreElement = document.getElementById('score-percentage');
        if (scoreElement) {
          scoreElement.textContent = `${percentage}%`;
        }
      }
    }
    
    function resetTest() {
      const testForm = document.getElementById('test-form');
      const testResults = document.getElementById('test-results');
      const certificateName = document.getElementById('certificate-name') as HTMLInputElement;
      
      if (!testForm || !testResults) return;
      
      testForm.classList.remove('hidden');
      testResults.classList.add('hidden');
      
      if (certificateName) {
        certificateName.value = '';
      }
      
      initializeTest();
    }
    
    function generateCertificate() {
      const nameInput = document.getElementById('certificate-name') as HTMLInputElement;
      
      if (!nameInput) return;
      
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('ProszÄ™ wprowadziÄ‡ imiÄ™ i nazwisko');
        return;
      }
      
      // Generowanie certyfikatu jako obraz Canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      if (!ctx) return;
      
      canvas.width = 1200;
      canvas.height = 800;
      
      // Gradient tÅ‚o
      const gradient = ctx.createLinearGradient(0, 0, 1200, 800);
      gradient.addColorStop(0, '#f0fdf4');
      gradient.addColorStop(1, '#ecfdf5');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 1200, 800);
      
      // Ramka
      ctx.strokeStyle = '#059669';
      ctx.lineWidth = 8;
      ctx.strokeRect(40, 40, 1120, 720);
      
      // WewnÄ™trzna ramka
      ctx.strokeStyle = '#34d399';
      ctx.lineWidth = 2;
      ctx.strokeRect(60, 60, 1080, 680);
      
      // NagÅ‚Ã³wek
      ctx.fillStyle = '#065f46';
      ctx.font = 'bold 48px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('ğŸ† CERTYFIKAT UKOÅƒCZENIA', 600, 150);
      
      // Nazwa kursu
      ctx.fillStyle = '#059669';
      ctx.font = 'bold 36px Arial';
      ctx.fillText('AI DLA ZIELONYCH', 600, 220);
      
      // Potwierdzenie
      ctx.fillStyle = '#374151';
      ctx.font = '24px Arial';
      ctx.fillText('Niniejszym poÅ›wiadcza siÄ™, Å¼e', 600, 300);
      
      // ImiÄ™ i nazwisko
      ctx.fillStyle = '#059669';
      ctx.font = 'bold 42px Arial';
      ctx.fillText(name.toUpperCase(), 600, 380);
      
      // Opis
      ctx.fillStyle = '#374151';
      ctx.font = '20px Arial';
      ctx.fillText('pomyÅ›lnie ukoÅ„czyÅ‚/ukoÅ„czyÅ‚a kurs podstaw sztucznej inteligencji', 600, 450);
      ctx.fillText('uzyskujÄ…c 100% poprawnych odpowiedzi w teÅ›cie koÅ„cowym', 600, 480);
      
      // Data
      const currentDate = new Date().toLocaleDateString('pl-PL', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      ctx.fillStyle = '#6b7280';
      ctx.font = '18px Arial';
      ctx.fillText(`${currentDate}`, 600, 580);
      
      // Podpis
      ctx.fillStyle = '#059669';
      ctx.font = 'italic 16px Arial';
      ctx.fillText('AI dla Zielonych - Kurs podstaw sztucznej inteligencji', 600, 650);
      
      // Unikalne ID certyfikatu
      const certificateId = 'AZ-' + Date.now().toString(36).toUpperCase();
      ctx.fillStyle = '#9ca3af';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      ctx.fillText(`ID certyfikatu: ${certificateId}`, 1140, 740);
      
      // Pobieranie certyfikatu
      const link = document.createElement('a');
      link.download = `certyfikat-ai-dla-zielonych-${name.replace(/\s+/g, '-').toLowerCase()}.png`;
      link.href = canvas.toDataURL('image/png', 1.0);
      
      // Dodaj feedback dla uÅ¼ytkownika
      const generateBtn = document.getElementById('generate-certificate');
      if (generateBtn) {
        generateBtn.textContent = 'â³ Generowanie...';
        generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
      
      // Symulacja krÃ³tkiego opÃ³Åºnienia dla lepszego UX
      setTimeout(() => {
        link.click();
        
        if (generateBtn) {
          generateBtn.textContent = 'âœ… Certyfikat pobrany!';
          setTimeout(() => {
            generateBtn.textContent = 'ğŸ† Wygeneruj certyfikat PDF';
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          }, 2000);
        }
      }, 500);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      initializeTest();
      
      const submitBtn = document.getElementById('submit-test');
      const retakeBtn = document.getElementById('retake-test');
      const retakeFailBtn = document.getElementById('retake-test-fail');
      const generateBtn = document.getElementById('generate-certificate');
      
      if (submitBtn) {
        submitBtn.addEventListener('click', showResults);
      }
      if (retakeBtn) {
        retakeBtn.addEventListener('click', resetTest);
      }
      if (retakeFailBtn) {
        retakeFailBtn.addEventListener('click', resetTest);
      }
      if (generateBtn) {
        generateBtn.addEventListener('click', generateCertificate);
      }
    });
  </script>
</Layout>
